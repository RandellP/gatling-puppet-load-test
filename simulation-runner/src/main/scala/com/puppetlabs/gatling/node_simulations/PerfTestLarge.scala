package com.puppetlabs.gatling.node_simulations
import com.puppetlabs.gatling.runner.SimulationWithScenario
import org.joda.time.LocalDateTime
import org.joda.time.format.ISODateTimeFormat
import java.util.UUID

import scala.concurrent.duration._
import scala.io.Source._
import scala.util.parsing.json._

import io.gatling.core.Predef._
import io.gatling.http.Predef._

class PerfTestLarge extends SimulationWithScenario {

	val reportFeeder = Array(
                         Map("reportFile" -> "NoChangesReport_0006_request.txt"),
                         Map("reportFile" -> "FailureReport_0006_request.txt"),
                         Map("reportFile" -> "CorrectiveChangeReport_0006_request.txt"),
                         Map("reportFile" -> "IntentionalChangeReport_0044_request.txt")
                       ).circular

	val baseHeaders = Map("Accept" -> "application/json, text/pson",
		"Accept-Encoding" -> "gzip;q=1.0,deflate;q=0.6,identity;q=0.3",
		"User-Agent" -> "Puppet/5.3.3 Ruby/2.4.2-p198 (x86_64-linux)")

	val headers_0 = baseHeaders ++ Map("X-Puppet-Version" -> "5.3.3")

	val headers_6 = baseHeaders ++ Map(
		"Connection" -> "close",
		"Content-Type" -> "application/json",
		"X-Puppet-Version" -> "5.3.3")

	val scn = scenario("perf_test_large")
	    .feed(reportFeeder)
		.exec(http("node")
			.get("/puppet/v3/node/${node}?environment=production&transaction_uuid=feaf75a3-c82c-4e06-9d02-5387f14034a0&fail_on_404=true")
			.headers(headers_0))
		.pause(103 milliseconds)
		.exec(http("filemeta pluginfacts")
			.get("/puppet/v3/file_metadatas/pluginfacts?environment=production&links=follow&recurse=true&source_permissions=use&ignore=.svn&ignore=CVS&ignore=.git&ignore=.hg&ignore=%2A.pot&checksum_type=md5")
			.headers(headers_0))
		.pause(1)
		.exec(http("filemeta plugins")
			.get("/puppet/v3/file_metadatas/plugins?environment=production&links=follow&recurse=true&source_permissions=ignore&ignore=.svn&ignore=CVS&ignore=.git&ignore=.hg&ignore=%2A.pot&checksum_type=md5")
			.headers(headers_0))
		.pause(1)
		.exec(http("")
			.get("/puppet/v3/file_metadatas/locales?environment=production&links=follow&recurse=true&source_permissions=ignore&ignore=.svn&ignore=CVS&ignore=.git&ignore=.hg&ignore=%2A.pot&ignore=config.yaml&checksum_type=md5")
			.headers(headers_0))
		.pause(1)
		.exec(http("catalog")
			.post("/puppet/v3/catalog/${node}?environment=production")
			.headers(headers_0)
			.formParam("environment", "production")
			.formParam("facts_format", "application/json")
			.formParam("facts", "%7B%22name%22%3A%22${node}%22%2C%22values%22%3A%7B%22aio_agent_build%22%3A%225.3.2.307.g483e5e4%22%2C%22aio_agent_version%22%3A%225.3.2.307%22%2C%22apache_version%22%3A%222.4.6%22%2C%22architecture%22%3A%22x86_64%22%2C%22augeas%22%3A%7B%22version%22%3A%221.8.1%22%7D%2C%22augeasversion%22%3A%221.8.1%22%2C%22bios_release_date%22%3A%2208%2F24%2F2006%22%2C%22bios_vendor%22%3A%22Xen%22%2C%22bios_version%22%3A%224.2.amazon%22%2C%22blockdevice_xvda_size%22%3A53687091200%2C%22blockdevices%22%3A%22xvda%22%2C%22chassistype%22%3A%22Other%22%2C%22choco_install_path%22%3A%22C%3A%5C%5CProgramData%5C%5Cchocolatey%22%2C%22chocolateyversion%22%3A%220%22%2C%22dhcp_servers%22%3A%7B%22eth0%22%3A%22172.31.32.1%22%2C%22system%22%3A%22172.31.32.1%22%7D%2C%22disks%22%3A%7B%22xvda%22%3A%7B%22size%22%3A%2250.00%20GiB%22%2C%22size_bytes%22%3A53687091200%7D%7D%2C%22dmi%22%3A%7B%22bios%22%3A%7B%22release_date%22%3A%2208%2F24%2F2006%22%2C%22vendor%22%3A%22Xen%22%2C%22version%22%3A%224.2.amazon%22%7D%2C%22chassis%22%3A%7B%22type%22%3A%22Other%22%7D%2C%22manufacturer%22%3A%22Xen%22%2C%22product%22%3A%7B%22name%22%3A%22HVM%20domU%22%2C%22serial_number%22%3A%22ec298ff5-2846-18cc-8b80-11335f9d272a%22%2C%22uuid%22%3A%22F58F29EC-4628-CC18-8B80-11335F9D272A%22%7D%7D%2C%22domain%22%3A%22us-west-2.compute.amazonaws.com%22%2C%22ec2_metadata%22%3A%7B%22ami-id%22%3A%22ami-1b17242b%22%2C%22ami-launch-index%22%3A%220%22%2C%22ami-manifest-path%22%3A%22%28unknown%29%22%2C%22block-device-mapping%22%3A%7B%22ami%22%3A%22%2Fdev%2Fsda1%22%2C%22root%22%3A%22%2Fdev%2Fsda1%22%7D%2C%22hostname%22%3A%22ip-172-31-41-73.us-west-2.compute.internal%22%2C%22instance-action%22%3A%22none%22%2C%22instance-id%22%3A%22i-0f208af579cc80e57%22%2C%22instance-type%22%3A%22c4.2xlarge%22%2C%22local-hostname%22%3A%22ip-172-31-41-73.us-west-2.compute.internal%22%2C%22local-ipv4%22%3A%22172.31.41.73%22%2C%22mac%22%3A%2202%3Aea%3A1b%3Aa8%3Aee%3Ab6%22%2C%22metrics%22%3A%7B%22vhostmd%22%3A%22%3C%3Fxml%20version%3D%5C%221.0%5C%22%20encoding%3D%5C%22UTF-8%5C%22%3F%3E%22%7D%2C%22network%22%3A%7B%22interfaces%22%3A%7B%22macs%22%3A%7B%2202%3Aea%3A1b%3Aa8%3Aee%3Ab6%22%3A%7B%22device-number%22%3A%220%22%2C%22interface-id%22%3A%22eni-053b9020%22%2C%22ipv4-associations%22%3A%7B%2234.216.156.230%22%3A%22172.31.41.73%22%7D%2C%22local-hostname%22%3A%22ip-172-31-41-73.us-west-2.compute.internal%22%2C%22local-ipv4s%22%3A%22172.31.41.73%22%2C%22mac%22%3A%2202%3Aea%3A1b%3Aa8%3Aee%3Ab6%22%2C%22owner-id%22%3A%22028918822489%22%2C%22public-hostname%22%3A%22${node}%22%2C%22public-ipv4s%22%3A%2234.216.156.230%22%2C%22security-group-ids%22%3A%22sg-41b94725%5Cnsg-e3460586%22%2C%22security-groups%22%3A%22beaker-ping%5CnBeaker-3425116409%22%2C%22subnet-id%22%3A%22subnet-4860a82d%22%2C%22subnet-ipv4-cidr-block%22%3A%22172.31.32.0%2F20%22%2C%22vpc-id%22%3A%22vpc-bb9866de%22%2C%22vpc-ipv4-cidr-block%22%3A%22172.31.0.0%2F16%22%2C%22vpc-ipv4-cidr-blocks%22%3A%22172.31.0.0%2F16%22%7D%7D%7D%7D%2C%22placement%22%3A%7B%22availability-zone%22%3A%22us-west-2b%22%7D%2C%22product-codes%22%3A%22aw0evgkw8e5c1q413zgy5pjce%22%2C%22profile%22%3A%22default-hvm%22%2C%22public-hostname%22%3A%22${node}%22%2C%22public-ipv4%22%3A%2234.216.156.230%22%2C%22public-keys%22%3A%7B%220%22%3A%7B%22openssh-key%22%3A%22ssh-rsa%20AAAAB3NzaC1yc2EAAAADAQABAAABAQDQoCK0rwo01qujE%2FdRDqKV79iGAgZfXseiiHZ%2F4zHRsoooZwSqFxYoH2PcXVquMMToT1JIxR6eLqk4dNI4n8AiZWoeHpJMmPMrNj4AeEF%2FrGTIoSiGkWrfJIeUZB0xz%2BDynhhTUZvfzyVqR28QMpx7oMR04MAXOtzmLhDzkiMax0wEg0QO15dwFooS0aL82TixFZ7kvoKzH5N3emDloYUjdHBl4n38OkTG120YutbluXj69mbl9xfxjMCBKIku7kgtvJcvNdwqw3dpw3WRHVSICmvdPvdJ%2F7gNifoE9WM6WonpvUfffKOQ8uxxmmWm4Zj%2FdAeSTr5qC6XkPBp8V%2BSN%20Beaker-samwoods-PuppetLabs455-corp-puppetlabs-net-2947050449-2018-01-31_16_05_36_038518000%22%7D%7D%2C%22reservation-id%22%3A%22r-064be41377ce0c935%22%2C%22security-groups%22%3A%22beaker-ping%5CnBeaker-3425116409%22%2C%22services%22%3A%7B%22domain%22%3A%22amazonaws.com%22%2C%22partition%22%3A%22aws%22%7D%7D%2C%22facterversion%22%3A%223.9.3%22%2C%22fake_domain%22%3A%22pgtomcat.mycompany.org%22%2C%22filesystems%22%3A%22iso9660%2Cxfs%22%2C%22fqdn%22%3A%22${node}%22%2C%22function%22%3A%22app%22%2C%22gid%22%3A%22root%22%2C%22gitlab_systemd%22%3Atrue%2C%22group%22%3A%22pgtomcat%22%2C%22hardwareisa%22%3A%22x86_64%22%2C%22hardwaremodel%22%3A%22x86_64%22%2C%22hostname%22%3A%22ec2-34-216-156-230%22%2C%22id%22%3A%22root%22%2C%22identity%22%3A%7B%22gid%22%3A0%2C%22group%22%3A%22root%22%2C%22privileged%22%3Atrue%2C%22uid%22%3A0%2C%22user%22%3A%22root%22%7D%2C%22interfaces%22%3A%22eth0%2Clo%22%2C%22ip6tables_version%22%3A%221.4.21%22%2C%22ipaddress%22%3A%22172.31.41.73%22%2C%22ipaddress6%22%3A%22fe80%3A%3Aea%3A1bff%3Afea8%3Aeeb6%22%2C%22ipaddress6_eth0%22%3A%22fe80%3A%3Aea%3A1bff%3Afea8%3Aeeb6%22%2C%22ipaddress6_lo%22%3A%22%3A%3A1%22%2C%22ipaddress_eth0%22%3A%22172.31.41.73%22%2C%22ipaddress_lo%22%3A%22127.0.0.1%22%2C%22iptables_version%22%3A%221.4.21%22%2C%22is_pe%22%3Afalse%2C%22is_virtual%22%3Atrue%2C%22java_default_home%22%3A%22%2Fusr%2Flib%2Fjvm%2Fjava-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64%22%2C%22java_libjvm_path%22%3A%22%2Fusr%2Flib%2Fjvm%2Fjava-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64%2Fjre%2Flib%2Famd64%2Fserver%22%2C%22java_major_version%22%3A%228%22%2C%22java_patch_level%22%3A%22161%22%2C%22java_version%22%3A%221.8.0_161%22%2C%22jenkins_plugins%22%3A%22%22%2C%22kernel%22%3A%22Linux%22%2C%22kernelmajversion%22%3A%223.10%22%2C%22kernelrelease%22%3A%223.10.0-123.8.1.el7.x86_64%22%2C%22kernelversion%22%3A%223.10.0%22%2C%22load_averages%22%3A%7B%2215m%22%3A0.38%2C%221m%22%3A0.17%2C%225m%22%3A0.27%7D%2C%22lsbdistcodename%22%3A%22Core%22%2C%22lsbdistdescription%22%3A%22CentOS%20Linux%20release%207.0.1406%20%28Core%29%22%2C%22lsbdistid%22%3A%22CentOS%22%2C%22lsbdistrelease%22%3A%227.0.1406%22%2C%22lsbmajdistrelease%22%3A%227%22%2C%22lsbminordistrelease%22%3A%220%22%2C%22lsbrelease%22%3A%22%3Acore-4.1-amd64%3Acore-4.1-noarch%3Acxx-4.1-amd64%3Acxx-4.1-noarch%3Adesktop-4.1-amd64%3Adesktop-4.1-noarch%3Alanguages-4.1-amd64%3Alanguages-4.1-noarch%3Aprinting-4.1-amd64%3Aprinting-4.1-noarch%22%2C%22macaddress%22%3A%2202%3Aea%3A1b%3Aa8%3Aee%3Ab6%22%2C%22macaddress_eth0%22%3A%2202%3Aea%3A1b%3Aa8%3Aee%3Ab6%22%2C%22manufacturer%22%3A%22Xen%22%2C%22memory%22%3A%7B%22system%22%3A%7B%22available%22%3A%2212.78%20GiB%22%2C%22available_bytes%22%3A13722427392%2C%22capacity%22%3A%2210.51%25%22%2C%22total%22%3A%2214.28%20GiB%22%2C%22total_bytes%22%3A15333281792%2C%22used%22%3A%221.50%20GiB%22%2C%22used_bytes%22%3A1610854400%7D%7D%2C%22memoryfree%22%3A%2212.78%20GiB%22%2C%22memoryfree_mb%22%3A13086.7265625%2C%22memorysize%22%3A%2214.28%20GiB%22%2C%22memorysize_mb%22%3A14622.95703125%2C%22mountpoints%22%3A%7B%22%2F%22%3A%7B%22available%22%3A%2247.39%20GiB%22%2C%22available_bytes%22%3A50885177344%2C%22capacity%22%3A%225.20%25%22%2C%22device%22%3A%22%2Fdev%2Fxvda1%22%2C%22filesystem%22%3A%22xfs%22%2C%22options%22%3A%5B%22rw%22%2C%22seclabel%22%2C%22relatime%22%2C%22attr2%22%2C%22inode64%22%2C%22noquota%22%5D%2C%22size%22%3A%2249.99%20GiB%22%2C%22size_bytes%22%3A53674864640%2C%22used%22%3A%222.60%20GiB%22%2C%22used_bytes%22%3A2789687296%7D%2C%22%2Fdev%2Fshm%22%3A%7B%22available%22%3A%227.14%20GiB%22%2C%22available_bytes%22%3A7666638848%2C%22capacity%22%3A%220%25%22%2C%22device%22%3A%22tmpfs%22%2C%22filesystem%22%3A%22tmpfs%22%2C%22options%22%3A%5B%22rw%22%2C%22seclabel%22%2C%22nosuid%22%2C%22nodev%22%5D%2C%22size%22%3A%227.14%20GiB%22%2C%22size_bytes%22%3A7666638848%2C%22used%22%3A%220%20bytes%22%2C%22used_bytes%22%3A0%7D%2C%22%2Frun%22%3A%7B%22available%22%3A%227.12%20GiB%22%2C%22available_bytes%22%3A7641157632%2C%22capacity%22%3A%220.33%25%22%2C%22device%22%3A%22tmpfs%22%2C%22filesystem%22%3A%22tmpfs%22%2C%22options%22%3A%5B%22rw%22%2C%22seclabel%22%2C%22nosuid%22%2C%22nodev%22%2C%22mode%3D755%22%5D%2C%22size%22%3A%227.14%20GiB%22%2C%22size_bytes%22%3A7666638848%2C%22used%22%3A%2224.30%20MiB%22%2C%22used_bytes%22%3A25481216%7D%2C%22%2Frun%2Fuser%2F0%22%3A%7B%22available%22%3A%221.43%20GiB%22%2C%22available_bytes%22%3A1533329408%2C%22capacity%22%3A%220%25%22%2C%22device%22%3A%22tmpfs%22%2C%22filesystem%22%3A%22tmpfs%22%2C%22options%22%3A%5B%22rw%22%2C%22seclabel%22%2C%22nosuid%22%2C%22nodev%22%2C%22relatime%22%2C%22size%3D1497392k%22%2C%22mode%3D700%22%5D%2C%22size%22%3A%221.43%20GiB%22%2C%22size_bytes%22%3A1533329408%2C%22used%22%3A%220%20bytes%22%2C%22used_bytes%22%3A0%7D%2C%22%2Fsys%2Ffs%2Fcgroup%22%3A%7B%22available%22%3A%227.14%20GiB%22%2C%22available_bytes%22%3A7666638848%2C%22capacity%22%3A%220%25%22%2C%22device%22%3A%22tmpfs%22%2C%22filesystem%22%3A%22tmpfs%22%2C%22options%22%3A%5B%22ro%22%2C%22seclabel%22%2C%22nosuid%22%2C%22nodev%22%2C%22noexec%22%2C%22mode%3D755%22%5D%2C%22size%22%3A%227.14%20GiB%22%2C%22size_bytes%22%3A7666638848%2C%22used%22%3A%220%20bytes%22%2C%22used_bytes%22%3A0%7D%7D%2C%22mtu_eth0%22%3A9001%2C%22mtu_lo%22%3A65536%2C%22netmask%22%3A%22255.255.240.0%22%2C%22netmask6%22%3A%22ffff%3Affff%3Affff%3Affff%3A%3A%22%2C%22netmask6_eth0%22%3A%22ffff%3Affff%3Affff%3Affff%3A%3A%22%2C%22netmask6_lo%22%3A%22ffff%3Affff%3Affff%3Affff%3Affff%3Affff%3Affff%3Affff%22%2C%22netmask_eth0%22%3A%22255.255.240.0%22%2C%22netmask_lo%22%3A%22255.0.0.0%22%2C%22network%22%3A%22172.31.32.0%22%2C%22network6%22%3A%22fe80%3A%3A%22%2C%22network6_eth0%22%3A%22fe80%3A%3A%22%2C%22network6_lo%22%3A%22%3A%3A1%22%2C%22network_eth0%22%3A%22172.31.32.0%22%2C%22network_lo%22%3A%22127.0.0.0%22%2C%22networking%22%3A%7B%22dhcp%22%3A%22172.31.32.1%22%2C%22domain%22%3A%22us-west-2.compute.amazonaws.com%22%2C%22fqdn%22%3A%22${node}%22%2C%22hostname%22%3A%22ec2-34-216-156-230%22%2C%22interfaces%22%3A%7B%22eth0%22%3A%7B%22bindings%22%3A%5B%7B%22address%22%3A%22172.31.41.73%22%2C%22netmask%22%3A%22255.255.240.0%22%2C%22network%22%3A%22172.31.32.0%22%7D%5D%2C%22bindings6%22%3A%5B%7B%22address%22%3A%22fe80%3A%3Aea%3A1bff%3Afea8%3Aeeb6%22%2C%22netmask%22%3A%22ffff%3Affff%3Affff%3Affff%3A%3A%22%2C%22network%22%3A%22fe80%3A%3A%22%7D%5D%2C%22dhcp%22%3A%22172.31.32.1%22%2C%22ip%22%3A%22172.31.41.73%22%2C%22ip6%22%3A%22fe80%3A%3Aea%3A1bff%3Afea8%3Aeeb6%22%2C%22mac%22%3A%2202%3Aea%3A1b%3Aa8%3Aee%3Ab6%22%2C%22mtu%22%3A9001%2C%22netmask%22%3A%22255.255.240.0%22%2C%22netmask6%22%3A%22ffff%3Affff%3Affff%3Affff%3A%3A%22%2C%22network%22%3A%22172.31.32.0%22%2C%22network6%22%3A%22fe80%3A%3A%22%7D%2C%22lo%22%3A%7B%22bindings%22%3A%5B%7B%22address%22%3A%22127.0.0.1%22%2C%22netmask%22%3A%22255.0.0.0%22%2C%22network%22%3A%22127.0.0.0%22%7D%5D%2C%22bindings6%22%3A%5B%7B%22address%22%3A%22%3A%3A1%22%2C%22netmask%22%3A%22ffff%3Affff%3Affff%3Affff%3Affff%3Affff%3Affff%3Affff%22%2C%22network%22%3A%22%3A%3A1%22%7D%5D%2C%22ip%22%3A%22127.0.0.1%22%2C%22ip6%22%3A%22%3A%3A1%22%2C%22mtu%22%3A65536%2C%22netmask%22%3A%22255.0.0.0%22%2C%22netmask6%22%3A%22ffff%3Affff%3Affff%3Affff%3Affff%3Affff%3Affff%3Affff%22%2C%22network%22%3A%22127.0.0.0%22%2C%22network6%22%3A%22%3A%3A1%22%7D%7D%2C%22ip%22%3A%22172.31.41.73%22%2C%22ip6%22%3A%22fe80%3A%3Aea%3A1bff%3Afea8%3Aeeb6%22%2C%22mac%22%3A%2202%3Aea%3A1b%3Aa8%3Aee%3Ab6%22%2C%22mtu%22%3A9001%2C%22netmask%22%3A%22255.255.240.0%22%2C%22netmask6%22%3A%22ffff%3Affff%3Affff%3Affff%3A%3A%22%2C%22network%22%3A%22172.31.32.0%22%2C%22network6%22%3A%22fe80%3A%3A%22%2C%22primary%22%3A%22eth0%22%7D%2C%22operatingsystem%22%3A%22CentOS%22%2C%22operatingsystemmajrelease%22%3A%227%22%2C%22operatingsystemrelease%22%3A%227.0.1406%22%2C%22os%22%3A%7B%22architecture%22%3A%22x86_64%22%2C%22distro%22%3A%7B%22codename%22%3A%22Core%22%2C%22description%22%3A%22CentOS%20Linux%20release%207.0.1406%20%28Core%29%22%2C%22id%22%3A%22CentOS%22%2C%22release%22%3A%7B%22full%22%3A%227.0.1406%22%2C%22major%22%3A%227%22%2C%22minor%22%3A%220%22%7D%2C%22specification%22%3A%22%3Acore-4.1-amd64%3Acore-4.1-noarch%3Acxx-4.1-amd64%3Acxx-4.1-noarch%3Adesktop-4.1-amd64%3Adesktop-4.1-noarch%3Alanguages-4.1-amd64%3Alanguages-4.1-noarch%3Aprinting-4.1-amd64%3Aprinting-4.1-noarch%22%7D%2C%22family%22%3A%22RedHat%22%2C%22hardware%22%3A%22x86_64%22%2C%22name%22%3A%22CentOS%22%2C%22release%22%3A%7B%22full%22%3A%227.0.1406%22%2C%22major%22%3A%227%22%2C%22minor%22%3A%220%22%7D%2C%22selinux%22%3A%7B%22config_mode%22%3A%22enforcing%22%2C%22config_policy%22%3A%22targeted%22%2C%22current_mode%22%3A%22permissive%22%2C%22enabled%22%3Atrue%2C%22enforced%22%3Afalse%2C%22policy_version%22%3A%2228%22%7D%7D%2C%22osfamily%22%3A%22RedHat%22%2C%22package_provider%22%3A%22yum%22%2C%22partitions%22%3A%7B%22%2Fdev%2Fxvda1%22%3A%7B%22filesystem%22%3A%22xfs%22%2C%22mount%22%3A%22%2F%22%2C%22size%22%3A%2250.00%20GiB%22%2C%22size_bytes%22%3A53685353984%2C%22uuid%22%3A%220f790447-ebef-4ca0-b229-d0aa1985d57f%22%7D%7D%2C%22path%22%3A%22%2Fusr%2Flocal%2Frvm%2Fgems%2Fruby-2.2.5%2Fbin%3A%2Fusr%2Flocal%2Frvm%2Fgems%2Fruby-2.2.5%40global%2Fbin%3A%2Fusr%2Flocal%2Frvm%2Frubies%2Fruby-2.2.5%2Fbin%3A%2Fusr%2Flib64%2Fqt-3.3%2Fbin%3APATH%3A%2Fopt%2Fpuppetlabs%2Fbin%3A%2Fusr%2Flocal%2Fsbin%3A%2Fusr%2Flocal%2Fbin%3A%2Fusr%2Fsbin%3A%2Fusr%2Fbin%3A%2Fusr%2Flocal%2Frvm%2Fbin%3A%2Froot%2Fbin%3A%2Fsbin%22%2C%22pe_concat_basedir%22%3A%22%2Fopt%2Fpuppetlabs%2Fpuppet%2Fcache%2Fpe_concat%22%2C%22pe_razor_server_version%22%3A%22package%20pe-razor-server%20is%20not%20installed%22%2C%22physicalprocessorcount%22%3A1%2C%22platform_symlink_writable%22%3Atrue%2C%22platform_tag%22%3A%22el-7-x86_64%22%2C%22processor0%22%3A%22Intel%28R%29%20Xeon%28R%29%20CPU%20E5-2666%20v3%20%40%202.90GHz%22%2C%22processor1%22%3A%22Intel%28R%29%20Xeon%28R%29%20CPU%20E5-2666%20v3%20%40%202.90GHz%22%2C%22processor2%22%3A%22Intel%28R%29%20Xeon%28R%29%20CPU%20E5-2666%20v3%20%40%202.90GHz%22%2C%22processor3%22%3A%22Intel%28R%29%20Xeon%28R%29%20CPU%20E5-2666%20v3%20%40%202.90GHz%22%2C%22processor4%22%3A%22Intel%28R%29%20Xeon%28R%29%20CPU%20E5-2666%20v3%20%40%202.90GHz%22%2C%22processor5%22%3A%22Intel%28R%29%20Xeon%28R%29%20CPU%20E5-2666%20v3%20%40%202.90GHz%22%2C%22processor6%22%3A%22Intel%28R%29%20Xeon%28R%29%20CPU%20E5-2666%20v3%20%40%202.90GHz%22%2C%22processor7%22%3A%22Intel%28R%29%20Xeon%28R%29%20CPU%20E5-2666%20v3%20%40%202.90GHz%22%2C%22processorcount%22%3A8%2C%22processors%22%3A%7B%22count%22%3A8%2C%22isa%22%3A%22x86_64%22%2C%22models%22%3A%5B%22Intel%28R%29%20Xeon%28R%29%20CPU%20E5-2666%20v3%20%40%202.90GHz%22%2C%22Intel%28R%29%20Xeon%28R%29%20CPU%20E5-2666%20v3%20%40%202.90GHz%22%2C%22Intel%28R%29%20Xeon%28R%29%20CPU%20E5-2666%20v3%20%40%202.90GHz%22%2C%22Intel%28R%29%20Xeon%28R%29%20CPU%20E5-2666%20v3%20%40%202.90GHz%22%2C%22Intel%28R%29%20Xeon%28R%29%20CPU%20E5-2666%20v3%20%40%202.90GHz%22%2C%22Intel%28R%29%20Xeon%28R%29%20CPU%20E5-2666%20v3%20%40%202.90GHz%22%2C%22Intel%28R%29%20Xeon%28R%29%20CPU%20E5-2666%20v3%20%40%202.90GHz%22%2C%22Intel%28R%29%20Xeon%28R%29%20CPU%20E5-2666%20v3%20%40%202.90GHz%22%5D%2C%22physicalcount%22%3A1%7D%2C%22productname%22%3A%22HVM%20domU%22%2C%22puppet_files_dir_present%22%3Afalse%2C%22puppet_inventory_metadata%22%3A%7B%22packages%22%3A%7B%22collection_enabled%22%3Afalse%2C%22last_collection_time%22%3A%220.0s%22%7D%7D%2C%22puppet_vardir%22%3A%22%2Fopt%2Fpuppetlabs%2Fpuppet%2Fcache%22%2C%22puppetversion%22%3A%225.3.3%22%2C%22root_home%22%3A%22%2Froot%22%2C%22rsyslog_version%22%3A%227.4.7%22%2C%22ruby%22%3A%7B%22platform%22%3A%22x86_64-linux%22%2C%22sitedir%22%3A%22%2Fopt%2Fpuppetlabs%2Fpuppet%2Flib%2Fruby%2Fsite_ruby%2F2.4.0%22%2C%22version%22%3A%222.4.2%22%7D%2C%22rubyplatform%22%3A%22x86_64-linux%22%2C%22rubysitedir%22%3A%22%2Fopt%2Fpuppetlabs%2Fpuppet%2Flib%2Fruby%2Fsite_ruby%2F2.4.0%22%2C%22rubyversion%22%3A%222.4.2%22%2C%22selinux%22%3Atrue%2C%22selinux_config_mode%22%3A%22enforcing%22%2C%22selinux_config_policy%22%3A%22targeted%22%2C%22selinux_current_mode%22%3A%22permissive%22%2C%22selinux_enforced%22%3Afalse%2C%22selinux_policyversion%22%3A%2228%22%2C%22serialnumber%22%3A%22ec298ff5-2846-18cc-8b80-11335f9d272a%22%2C%22service_provider%22%3A%22systemd%22%2C%22ssh%22%3A%7B%22ecdsa%22%3A%7B%22fingerprints%22%3A%7B%22sha1%22%3A%22SSHFP%203%201%2039c008a1084fd645af21ca73831a515c86beb21c%22%2C%22sha256%22%3A%22SSHFP%203%202%20c4b630841b97333597a517ada8419a4ae9f8ddd7ad33c4043663a310f3a5de7f%22%7D%2C%22key%22%3A%22AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMD2xqC7aA%2FWcq691vLjx0UWjeWxG2CCVbBZVrI6aw4dvf0hapB5RalbnXIjGz12oIPqgiezRC%2FxjkHkvQvOEw4%3D%22%7D%2C%22ed25519%22%3A%7B%22fingerprints%22%3A%7B%22sha1%22%3A%22SSHFP%204%201%20b62f6a8f621b7f1f65c1fbf8dd0ee50b82692c91%22%2C%22sha256%22%3A%22SSHFP%204%202%208297364529cd3d564121700040b1c35176463a6d55517b2a49da43f2247abdfe%22%7D%2C%22key%22%3A%22AAAAC3NzaC1lZDI1NTE5AAAAIOpDMV80YZbrLscxxTWbKvu3gaYUHw0BIgR5Y7vL3I19%22%7D%2C%22rsa%22%3A%7B%22fingerprints%22%3A%7B%22sha1%22%3A%22SSHFP%201%201%2077d992496e8f1bce51a6fe5159d6ba27056f6c9d%22%2C%22sha256%22%3A%22SSHFP%201%202%20eba50e1a929cd452025c50f5bd24bef45875605386b7da5fa80fda37339c853d%22%7D%2C%22key%22%3A%22AAAAB3NzaC1yc2EAAAADAQABAAABAQDEYrFRJiUVaLG%2BQgsU2GcxjPbkLwN7HBakRp6%2FRYF9M4uFhMme%2FBqRTk8UJf09kMiLkxxmssEwH%2FioDjIi9QLrqGXT%2FsbS%2BfzN0Yc0JWsftr0mgSqp%2BAWiG452mg2bV7snTEPkz%2Fk1d0h01T3M0xtTQkC0XFi%2BemDwcr9J%2BgGCmrLD%2BogsJqlekk0wC1AHl7qEYIWe%2FPzF%2Bi50xBSHF3KgQY7%2BYtsp7lEr6xnE%2B38TG7z7g4hW8DPbCIpvPeauPkTSFtUHRIgWYg%2Fxk94Wo1yIGRB%2FifBFKZ3CwJ9dzGJr81X1YoO6vUlI%2FPiP1RnKg2E9BD0pVYzxq%2FAGlr0k9ZVH%22%7D%7D%2C%22sshecdsakey%22%3A%22AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMD2xqC7aA%2FWcq691vLjx0UWjeWxG2CCVbBZVrI6aw4dvf0hapB5RalbnXIjGz12oIPqgiezRC%2FxjkHkvQvOEw4%3D%22%2C%22sshed25519key%22%3A%22AAAAC3NzaC1lZDI1NTE5AAAAIOpDMV80YZbrLscxxTWbKvu3gaYUHw0BIgR5Y7vL3I19%22%2C%22sshfp_ecdsa%22%3A%22SSHFP%203%201%2039c008a1084fd645af21ca73831a515c86beb21c%5CnSSHFP%203%202%20c4b630841b97333597a517ada8419a4ae9f8ddd7ad33c4043663a310f3a5de7f%22%2C%22sshfp_ed25519%22%3A%22SSHFP%204%201%20b62f6a8f621b7f1f65c1fbf8dd0ee50b82692c91%5CnSSHFP%204%202%208297364529cd3d564121700040b1c35176463a6d55517b2a49da43f2247abdfe%22%2C%22sshfp_rsa%22%3A%22SSHFP%201%201%2077d992496e8f1bce51a6fe5159d6ba27056f6c9d%5CnSSHFP%201%202%20eba50e1a929cd452025c50f5bd24bef45875605386b7da5fa80fda37339c853d%22%2C%22sshrsakey%22%3A%22AAAAB3NzaC1yc2EAAAADAQABAAABAQDEYrFRJiUVaLG%2BQgsU2GcxjPbkLwN7HBakRp6%2FRYF9M4uFhMme%2FBqRTk8UJf09kMiLkxxmssEwH%2FioDjIi9QLrqGXT%2FsbS%2BfzN0Yc0JWsftr0mgSqp%2BAWiG452mg2bV7snTEPkz%2Fk1d0h01T3M0xtTQkC0XFi%2BemDwcr9J%2BgGCmrLD%2BogsJqlekk0wC1AHl7qEYIWe%2FPzF%2Bi50xBSHF3KgQY7%2BYtsp7lEr6xnE%2B38TG7z7g4hW8DPbCIpvPeauPkTSFtUHRIgWYg%2Fxk94Wo1yIGRB%2FifBFKZ3CwJ9dzGJr81X1YoO6vUlI%2FPiP1RnKg2E9BD0pVYzxq%2FAGlr0k9ZVH%22%2C%22stage%22%3A%22prod%22%2C%22staging_http_get%22%3A%22curl%22%2C%22system_uptime%22%3A%7B%22days%22%3A0%2C%22hours%22%3A0%2C%22seconds%22%3A2307%2C%22uptime%22%3A%220%3A38%20hours%22%7D%2C%22timezone%22%3A%22UTC%22%2C%22uptime%22%3A%220%3A38%20hours%22%2C%22uptime_days%22%3A0%2C%22uptime_hours%22%3A0%2C%22uptime_seconds%22%3A2307%2C%22uuid%22%3A%22F58F29EC-4628-CC18-8B80-11335F9D272A%22%2C%22virtual%22%3A%22xenhvm%22%2C%22whereami%22%3A%22portland%22%2C%22clientcert%22%3A%22${node}%22%2C%22clientversion%22%3A%225.3.3%22%2C%22clientnoop%22%3Afalse%7D%2C%22timestamp%22%3A%222018-02-01T00%3A44%3A31.810459590%2B00%3A00%22%2C%22expiration%22%3A%222125-02-01T01%3A14%3A31.810739722%2B00%3A00%22%7D")
			.formParam("transaction_uuid", "feaf75a3-c82c-4e06-9d02-5387f14034a0")
			.formParam("static_catalog", "true")
			.formParam("checksum_type", "md5.sha256")
			.formParam("fail_on_404", "true"))
		.pause(2)
		.exec(http("filemeta mco plugins")
			.get("/puppet/v3/file_metadatas/modules/puppet_enterprise/mcollective/plugins?environment=production&links=manage&recurse=true&source_permissions=ignore&checksum_type=md5")
			.headers(headers_0))
		.pause(4)
		.exec((session:Session) => {
			session.set("reportTimestamp",
				LocalDateTime.now.toString(ISODateTimeFormat.dateTime()))
		})
		.exec((session:Session) => {
			session.set("transactionUuid",
				UUID.randomUUID().toString())
		})
		.exec(http("report")
			.put("/puppet/v3/report/${node}?environment=production&")
			.headers(headers_6)
			.body(ElFileBody("${reportFile}"))

}
